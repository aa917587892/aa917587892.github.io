

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
  <title>PHP和jQuery创建一个简单的在线聊天工具 - Hexo</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>远方</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="PHP和jQuery创建一个简单的在线聊天工具">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-06-08 20:18" pubdate>
        June 8, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      45
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">PHP和jQuery创建一个简单的在线聊天工具</h1>
            
            <div class="markdown-body">
              <h1 id="学习目标："><a href="#学习目标：" class="headerlink" title="学习目标："></a>学习目标：</h1><p>在本教程中，我们将要使用PHP和jQuery创建一个简单的在线聊天工具。 这种实用性的模块对于你想要有实时在线客户支持系统的网站可以说是完美。<br><img src="https://img-blog.csdnimg.cn/20210602152201308.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzUwMjU3Ng==,size_16,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br>废话不多说直接开始。</p>
<h1 id="步骤1：HTML的代码结构"><a href="#步骤1：HTML的代码结构" class="headerlink" title="步骤1：HTML的代码结构"></a>步骤1：HTML的代码结构</h1><p>创建一个index.php</p>
<div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class="hljs-meta-string">&quot;https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Chat - Customer Module<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;style.css&quot;</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
 
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;wrapper&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;menu&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;welcome&quot;</span>&gt;</span>Welcome, <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;logout&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;exit&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span>&gt;</span>Exit Chat<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;clear:both&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
     
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;chatbox&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
     
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;message&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;usermsg&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;usermsg&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;63&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;submitmsg&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>  <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;submitmsg&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Send&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span>
<span class="javascript"><span class="hljs-comment">// jQuery Document</span></span>
<span class="javascript">$(<span class="hljs-built_in">document</span>).ready(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;</span>
<span class="javascript"> </span>
<span class="javascript">&#125;);</span>
<span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>
<p><strong>css样式</strong></p>
<div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123;
    <span class="hljs-attribute">font</span>:<span class="hljs-number">12px</span> arial;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#222</span>;
    <span class="hljs-attribute">text-align</span>:center;
    <span class="hljs-attribute">padding</span>:<span class="hljs-number">35px</span>; &#125;
  
<span class="hljs-selector-tag">form</span>, <span class="hljs-selector-tag">p</span>, <span class="hljs-selector-tag">span</span> &#123;
    <span class="hljs-attribute">margin</span>:<span class="hljs-number">0</span>;
    <span class="hljs-attribute">padding</span>:<span class="hljs-number">0</span>; &#125;
  
<span class="hljs-selector-tag">input</span> &#123; <span class="hljs-attribute">font</span>:<span class="hljs-number">12px</span> arial; &#125;
  
<span class="hljs-selector-tag">a</span> &#123;
    <span class="hljs-attribute">color</span>:<span class="hljs-number">#0000FF</span>;
    <span class="hljs-attribute">text-decoration</span>:none; &#125;
  
    <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> &#123; <span class="hljs-attribute">text-decoration</span>:underline; &#125;
  
<span class="hljs-selector-id">#wrapper</span>, <span class="hljs-selector-id">#loginform</span> &#123;
    <span class="hljs-attribute">margin</span>:<span class="hljs-number">0</span> auto;
    <span class="hljs-attribute">padding-bottom</span>:<span class="hljs-number">25px</span>;
    <span class="hljs-attribute">background</span>:<span class="hljs-number">#EBF4FB</span>;
    <span class="hljs-attribute">width</span>:<span class="hljs-number">504px</span>;
    <span class="hljs-attribute">border</span>:<span class="hljs-number">1px</span> solid <span class="hljs-number">#ACD8F0</span>; &#125;
  
<span class="hljs-selector-id">#loginform</span> &#123; <span class="hljs-attribute">padding-top</span>:<span class="hljs-number">18px</span>; &#125;
  
    <span class="hljs-selector-id">#loginform</span> <span class="hljs-selector-tag">p</span> &#123; <span class="hljs-attribute">margin</span>: <span class="hljs-number">5px</span>; &#125;
  
<span class="hljs-selector-id">#chatbox</span> &#123;
    <span class="hljs-attribute">text-align</span><span class="hljs-selector-pseudo">:left</span>;
    <span class="hljs-attribute">margin</span>:<span class="hljs-number">0</span> auto;
    <span class="hljs-attribute">margin-bottom</span>:<span class="hljs-number">25px</span>;
    <span class="hljs-attribute">padding</span>:<span class="hljs-number">10px</span>;
    <span class="hljs-attribute">background</span>:<span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">height</span>:<span class="hljs-number">270px</span>;
    <span class="hljs-attribute">width</span>:<span class="hljs-number">430px</span>;
    <span class="hljs-attribute">border</span>:<span class="hljs-number">1px</span> solid <span class="hljs-number">#ACD8F0</span>;
    <span class="hljs-attribute">overflow</span>:auto; &#125;
  
<span class="hljs-selector-id">#usermsg</span> &#123;
    <span class="hljs-attribute">width</span>:<span class="hljs-number">395px</span>;
    <span class="hljs-attribute">border</span>:<span class="hljs-number">1px</span> solid <span class="hljs-number">#ACD8F0</span>; &#125;
  
<span class="hljs-selector-id">#submit</span> &#123; <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>; &#125;
  
<span class="hljs-selector-class">.error</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-number">#ff0000</span>; &#125;
  
<span class="hljs-selector-id">#menu</span> &#123; <span class="hljs-attribute">padding</span>:<span class="hljs-number">12.5px</span> <span class="hljs-number">25px</span> <span class="hljs-number">12.5px</span> <span class="hljs-number">25px</span>; &#125;
  
<span class="hljs-selector-class">.welcome</span> &#123; <span class="hljs-attribute">float</span><span class="hljs-selector-pseudo">:left</span>; &#125;
  
<span class="hljs-selector-class">.logout</span> &#123; <span class="hljs-attribute">float</span><span class="hljs-selector-pseudo">:right</span>; &#125;
  
<span class="hljs-selector-class">.msgln</span> &#123; <span class="hljs-attribute">margin</span>:<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">0</span>; &#125;</code></pre></div>
<p>上面这些CSS没什么特别的，除了部分的id或者class，我们将要在之后再为它们添加与修改</p>
<h1 id="步骤2：使用php创建登陆表单"><a href="#步骤2：使用php创建登陆表单" class="headerlink" title="步骤2：使用php创建登陆表单"></a>步骤2：使用php创建登陆表单</h1><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?</span> <span class="hljs-comment">//放入index.php &lt;html&gt;标签的上方 </span>
<span class="hljs-comment">//在信息存储到 PHP session 中之前，首先必须启动会话。session_start() 函数必须位于 &lt;html&gt; 标签之前：</span>
session_start();
 
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loginForm</span>(<span class="hljs-params"></span>)</span>&#123; <span class="hljs-comment">//这是一个简单给自己命名的html架子</span>
    <span class="hljs-keyword">echo</span><span class="hljs-string">&#x27;</span>
<span class="hljs-string">    &lt;div id=&quot;loginform&quot;&gt;</span>
<span class="hljs-string">    &lt;form action=&quot;index.php&quot; method=&quot;post&quot;&gt;</span>
<span class="hljs-string">        &lt;p&gt;Please enter your name to continue:&lt;/p&gt;</span>
<span class="hljs-string">        &lt;label for=&quot;name&quot;&gt;Name:&lt;/label&gt;</span>
<span class="hljs-string">        &lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;name&quot; /&gt;</span>
<span class="hljs-string">        &lt;input type=&quot;submit&quot; name=&quot;enter&quot; id=&quot;enter&quot; value=&quot;Enter&quot; /&gt;</span>
<span class="hljs-string">    &lt;/form&gt;</span>
<span class="hljs-string">    &lt;/div&gt;</span>
<span class="hljs-string">    &#x27;</span>;
&#125;
 
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;enter&#x27;</span>]))&#123;<span class="hljs-comment">//isset() 函数用于检测变量是否已设置并且非 NULL。</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>] != <span class="hljs-string">&quot;&quot;</span>)&#123;
        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = stripslashes(htmlspecialchars(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>]));
    &#125;<span class="hljs-comment">//stripslashes()删除反斜杠“/”。htmlspecialchars把预定义的字符 &quot;&lt;&quot; （小于）和 &quot;&gt;&quot; （大于）转换为 HTML 实体</span>
    <span class="hljs-keyword">else</span>&#123;
        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;span class=&quot;error&quot;&gt;Please type in a name&lt;/span&gt;&#x27;</span>;
    &#125;
&#125;
<span class="hljs-meta">?&gt;</span></code></pre></div>
<p>我们创建的这个loginForm()的function是由一个简单的登录表单组成的，它会询问用户的名字。 接下来，使用一个if和else的声明来验证这个人输入的名字。 如果一个用户输入了名字，我们将设置这个名字为$_SESSION[‘name’]。 由于我们将使用基于cookie的session来存储名字，所以我们必须要在任何东西反馈到浏览器之前请求一个session_start()。</p>
<p>有一件事情你可能需要额外的注意一下，我们使用了htmlspecialchars() function，这个会转换特殊符号到HTML实体，以此来保护名字变量的字符不会成为跨站点脚本（XSS）的受害者。 我们将在之后同时添加这个功能到将要发布在聊天记录里面的文字变量上。</p>
<h1 id="步骤3：显示登陆表单"><a href="#步骤3：显示登陆表单" class="headerlink" title="步骤3：显示登陆表单"></a>步骤3：显示登陆表单</h1><p>如果用户并没有登录，并且还没有产生session，为了要显示登录的表单，我们需要在原始代码中的#wrapper div和script标签周围使用另外一个if和else的声明。 反之，如果用户已经登录而且已经有了一个session，这个声明将隐藏登录表单，并且显示聊天框。</p>
<div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>]))&#123;<span class="hljs-comment">//判断是否有session 如果为空调动loginForm()</span>
    loginForm();
&#125;
<span class="hljs-keyword">else</span>&#123;
<span class="hljs-meta">?&gt;</span>
&lt;div id=<span class="hljs-string">&quot;wrapper&quot;</span>&gt;
    &lt;div id=<span class="hljs-string">&quot;menu&quot;</span>&gt;
        &lt;p <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">welcome</span>&quot;&gt;<span class="hljs-title">Welcome</span>, &lt;<span class="hljs-title">b</span>&gt;&lt;?<span class="hljs-title">php</span> <span class="hljs-title">echo</span> $<span class="hljs-title">_SESSION</span>[&#x27;<span class="hljs-title">name</span>&#x27;]; ?&gt;&lt;/<span class="hljs-title">b</span>&gt;&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="hljs-class">        &lt;<span class="hljs-title">p</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">logout</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">exit</span>&quot; <span class="hljs-title">href</span>=&quot;#&quot;&gt;<span class="hljs-title">Exit</span> <span class="hljs-title">Chat</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">style</span>=&quot;<span class="hljs-title">clear</span>:<span class="hljs-title">both</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;    </span>
<span class="hljs-class">    &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">chatbox</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-class">     </span>
<span class="hljs-class">    &lt;<span class="hljs-title">form</span> <span class="hljs-title">name</span>=&quot;<span class="hljs-title">message</span>&quot; <span class="hljs-title">action</span>=&quot;&quot;&gt;</span>
<span class="hljs-class">        &lt;<span class="hljs-title">input</span> <span class="hljs-title">name</span>=&quot;<span class="hljs-title">usermsg</span>&quot; <span class="hljs-title">type</span>=&quot;<span class="hljs-title">text</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">usermsg</span>&quot; <span class="hljs-title">size</span>=&quot;63&quot; /&gt;</span>
<span class="hljs-class">        &lt;<span class="hljs-title">input</span> <span class="hljs-title">name</span>=&quot;<span class="hljs-title">submitmsg</span>&quot; <span class="hljs-title">type</span>=&quot;<span class="hljs-title">submit</span>&quot;  <span class="hljs-title">id</span>=&quot;<span class="hljs-title">submitmsg</span>&quot; <span class="hljs-title">value</span>=&quot;<span class="hljs-title">Send</span>&quot; /&gt;</span>
<span class="hljs-class">    &lt;/<span class="hljs-title">form</span>&gt;</span>
<span class="hljs-class">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-class">&lt;<span class="hljs-title">script</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">text</span>/<span class="hljs-title">javascript</span>&quot; <span class="hljs-title">src</span>=&quot;<span class="hljs-title">http</span>://<span class="hljs-title">ajax</span>.<span class="hljs-title">googleapis</span>.<span class="hljs-title">com</span>/<span class="hljs-title">ajax</span>/<span class="hljs-title">libs</span>/<span class="hljs-title">jquery</span>/1.3/<span class="hljs-title">jquery</span>.<span class="hljs-title">min</span>.<span class="hljs-title">js</span>&quot;&gt;&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-class">&lt;<span class="hljs-title">script</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">text</span>/<span class="hljs-title">javascript</span>&quot;&gt;</span>
<span class="hljs-class">// <span class="hljs-title">jQuery</span> <span class="hljs-title">Document</span></span>
<span class="hljs-class">$(<span class="hljs-title">document</span>).<span class="hljs-title">ready</span>(<span class="hljs-title">function</span>()</span>&#123;
		.....
&#125;);
&lt;/script&gt;
<span class="hljs-meta">&lt;?php</span>
&#125;
<span class="hljs-meta">?&gt;</span></code></pre></div>
<h1 id="步骤4：处理用户的输入"><a href="#步骤4：处理用户的输入" class="headerlink" title="步骤4：处理用户的输入"></a>步骤4：处理用户的输入</h1><p>在用户提交了表单以后，我们希望抓取他们的输入数据并且将它们写入到聊天记录里面， 要想完成这个，我们必须使用jQuery和PHP来同步客户端和服务器端的数据。</p>
<div class="code-wrapper"><pre><code class="hljs php">&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;
<span class="hljs-comment">// jQuery Document</span>
$(document).ready(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;

		<span class="hljs-comment">//用户点击发送内容</span>
	$(<span class="hljs-string">&quot;#submitmsg&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;	
		<span class="hljs-keyword">var</span> clientmsg = $(<span class="hljs-string">&quot;#usermsg&quot;</span>).val();
		$.post(<span class="hljs-string">&quot;post.php&quot;</span>, &#123;text: clientmsg&#125;);				
		$(<span class="hljs-string">&quot;#usermsg&quot;</span>).attr(<span class="hljs-string">&quot;value&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);
		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
	&#125;);
&#125;);
&lt;/script&gt;</code></pre></div>
<ol>
<li>在我们做任何事情之前，我们必须先抓取用户的输入数据，或者说是他们所输入到#submitmsg input里面的文字。 这个可以使用val()功能来实现，它会抓取表单里面的所有数据。 我们将抓取的数据放入到clientmsg变量里面。</li>
<li>接下来是最重要的一个部分：jQuery POST 请求。 这一步会发送一个POST的请求到我们稍后会创建的post.php文件， 它会POST客户端的输入数据，或者任何已经被存储到clientmsg变量的数据。</li>
<li>在最后，我们将设置value属性的值到空白来清除#usermsg input。</li>
</ol>
<p>** 创建post.php**<br> 现在，我们有了POST的数据，并且每一次当用户提交表单并发送一条新的消息的时候，数据们都被发送到了post.php文件里。 我们现在的目标就是抓取这些数据，然后回过头来写入到我们的聊天记录框里。<br> <div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?</span>
session_start();
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>]))&#123;
    <span class="hljs-variable">$text</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;text&#x27;</span>];
     
    <span class="hljs-variable">$fp</span> = fopen(<span class="hljs-string">&quot;log.html&quot;</span>, <span class="hljs-string">&#x27;a&#x27;</span>);
    fwrite(<span class="hljs-variable">$fp</span>, <span class="hljs-string">&quot;&lt;div class=&#x27;msgln&#x27;&gt;(&quot;</span>.date(<span class="hljs-string">&quot;g:i A&quot;</span>).<span class="hljs-string">&quot;) &lt;b&gt;&quot;</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>].<span class="hljs-string">&quot;&lt;/b&gt;: &quot;</span>.stripslashes(htmlspecialcars(<span class="hljs-variable">$text</span>)).<span class="hljs-string">&quot;&lt;br&gt;&lt;/div&gt;&quot;</span>);
    <span class="hljs-comment">//&quot;a&quot; （写入方式打开，将文件指针指向文件末尾进行写入，如果文件不存在则尝试创建之）</span>
    fclose(<span class="hljs-variable">$fp</span>);<span class="hljs-comment">//关闭打开的文件</span>
&#125;
<span class="hljs-meta">?&gt;</span></code></pre></div></p>
<ol>
<li>在我们做任何事情之前，我们必须先用session_start()功能来开始post.php文件，因为我们也会在这个文件里面使用用户名字的session。</li>
<li>在做任何事情之前，我们需要使用isset布尔值，来检查如果session中’name’是否已经存在了。</li>
<li>现在我们将要抓取那些使用jQuery被发送到该文件的POST的数据， 并且我们将这些数据存储入$text变量。</li>
<li>这些所有的用户输入数据，都将被存储在log.html文件里。 为了完成这一步，我们将使用fopen功能的’a’模式打开文件，根据php.net的规则打开文件且仅限写入；接下来放置文件指示到文件的最后。 如果这个文件并不存在，那么尝试创建它。 接下来，我们使用fwrite()功能来写入我们的消息到这个文件里。</li>
<li>我们即将写入的消息将会被封闭在.msgIn div里面， 它会包含数据、使用date()功能所生成的时间、用户的session、以及内容等，同样的使用htmlspecialchars()功能来防止跨站点脚本XSS。<br>最后，我们使用fclose()来结束我们的文件操控。</li>
</ol>
<h1 id="步骤5：显示聊天记录（log-html）-内容"><a href="#步骤5：显示聊天记录（log-html）-内容" class="headerlink" title="步骤5：显示聊天记录（log.html） 内容"></a>步骤5：显示聊天记录（log.html） 内容</h1><p>所有用户已经发布的消息都被处理过了，并且我们也是用jQuery将它们发布了；它们是被PHP写入到聊天记录框里面的， 所以唯一剩下来需要走的就是显示这些更新过的聊天记录给用户。</p>
<p>有些时候为了给自己省事，如果聊天文件里面已经有内容了的话，我们需要预先读取聊天记录到#chatbox div。</p>
<div class="code-wrapper"><pre><code class="hljs php">&lt;div id=<span class="hljs-string">&quot;chatbox&quot;</span>&gt;<span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span>(file_exists(<span class="hljs-string">&quot;log.html&quot;</span>) &amp;&amp; filesize(<span class="hljs-string">&quot;log.html&quot;</span>) &gt; <span class="hljs-number">0</span>)&#123;
<span class="hljs-comment">//file_exists() 指定的文件是否存在filesize()文件大小</span>
    <span class="hljs-variable">$handle</span> = fopen(<span class="hljs-string">&quot;log.html&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>);
    <span class="hljs-variable">$contents</span> = fread(<span class="hljs-variable">$handle</span>, filesize(<span class="hljs-string">&quot;log.html&quot;</span>));
    fclose(<span class="hljs-variable">$handle</span>);     
    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$contents</span>;
&#125;
<span class="hljs-meta">?&gt;</span>&lt;/div&gt;</code></pre></div>
<p>这一次我们只是读取并且输出这些文件的内容到页面上。</p>
<p><strong>jquery.ajax请求</strong></p>
<p>ajax请求是我们做的所有事情的核心， 这个请求不仅仅允许我们在不刷新页面的情况下通过表单发送和接受数据，而且还允许我们处理数据请求。</p>
<div class="code-wrapper"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadLog</span>(<span class="hljs-params"></span>)</span>&#123;
		$.ajax(&#123;
			<span class="hljs-attr">url</span>: <span class="hljs-string">&quot;log.html&quot;</span>,
			<span class="hljs-attr">cache</span>: <span class="hljs-literal">false</span>,
			<span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">html</span>)</span>&#123;		
				$(<span class="hljs-string">&quot;#chatbox&quot;</span>).html(html); <span class="hljs-comment">//Insert chat log into the #chatbox div				</span>
		  	&#125;,
		&#125;);
	&#125;</code></pre></div>
<p>我们将ajax的请求囊括在一个function里面， 过一会你就知道为什么了。 你可以看到，在上面，我们仅仅使用了3个jQuery ajax的请求对象。</p>
<p>url: 一个URL请求的字符串 我们将使用我们的聊天记录文件名log.html。<br>cache: 这个会避免我们的文件被放入缓存。 它会确保我们每一次发送请求的时候都会得到一个最新的聊天记录。<br>success: 这个允许我们附上一个功能来传递我们请求的数据。<br>你可以看到，我们接着移动我们请求的数据（html）到#chatbox div。</p>
<p><strong>自动滚动</strong><br>由于你可能在别的聊天工具里面看过，如果聊天记录的容器（#chatbox)的内容溢出了就会自动的向下滚动。 我们将要实现一个简单的而又相似的效果，需要做的是在我们请求ajax的前后对比容器的滚动高度。 如果你滚动的高度大于请求之后的高度，我们会使用jQuery的动画效果来滚动#chatbox div。</p>
<div class="code-wrapper"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadLog</span>(<span class="hljs-params"></span>)</span>&#123;		
		<span class="hljs-keyword">var</span> oldscrollHeight = $(<span class="hljs-string">&quot;#chatbox&quot;</span>).attr(<span class="hljs-string">&quot;scrollHeight&quot;</span>) - <span class="hljs-number">20</span>; <span class="hljs-comment">//请求之前滚动的高度</span>
		$.ajax(&#123;
			<span class="hljs-attr">url</span>: <span class="hljs-string">&quot;log.html&quot;</span>,
			<span class="hljs-attr">cache</span>: <span class="hljs-literal">false</span>,
			<span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">html</span>)</span>&#123;		
				$(<span class="hljs-string">&quot;#chatbox&quot;</span>).html(html); <span class="hljs-comment">//添加聊天记录	</span>
				
				<span class="hljs-comment">//Auto-scroll			</span>
				<span class="hljs-keyword">var</span> newscrollHeight = $(<span class="hljs-string">&quot;#chatbox&quot;</span>).attr(<span class="hljs-string">&quot;scrollHeight&quot;</span>) - <span class="hljs-number">20</span>; <span class="hljs-comment">//Scroll height after the request</span>
				<span class="hljs-keyword">if</span>(newscrollHeight &gt; oldscrollHeight)&#123;
					$(<span class="hljs-string">&quot;#chatbox&quot;</span>).animate(&#123; <span class="hljs-attr">scrollTop</span>: newscrollHeight &#125;, <span class="hljs-string">&#x27;normal&#x27;</span>); <span class="hljs-comment">//scrollTop垂直滚动条的位置</span>
				&#125;				
		  	&#125;,
		&#125;);
	&#125;</code></pre></div>
<p>先请求现在#chatbox标签的高度，在请求ajax后的#chatbox标签高度。两者比较大小如果ajax大则通过.animate({})改变</p>
<p><strong>保持数据的不断更新</strong></p>
<div class="code-wrapper"><pre><code class="hljs php">setInterval (loadLog, <span class="hljs-number">2500</span>);	
<span class="hljs-comment">//Reload file every 2500 ms or x ms if you wish to change the second parameter</span></code></pre></div>

<p>我们问题的回答你可以在setInterval function的那一行找到， 这个功能每2.5秒就会运行一次LoadLog() function，并且loadLog function会请求更新过的数据以及自动滚动的div。</p>
<h1 id="步骤6：退出聊天室"><a href="#步骤6：退出聊天室" class="headerlink" title="步骤6：退出聊天室"></a>步骤6：退出聊天室</h1><p>为了允许用户登出并结束session，我们将要使用jQuery来完成它。</p>
<div class="code-wrapper"><pre><code class="hljs js">&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;
<span class="hljs-comment">// jQuery Document</span>
$(<span class="hljs-built_in">document</span>).ready(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;
	<span class="hljs-comment">//If user wants to end session</span>
	$(<span class="hljs-string">&quot;#exit&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;
		<span class="hljs-keyword">var</span> exit = confirm(<span class="hljs-string">&quot;Are you sure you want to end the session?&quot;</span>);
		<span class="hljs-keyword">if</span>(exit==<span class="hljs-literal">true</span>)&#123;<span class="hljs-built_in">window</span>.location = <span class="hljs-string">&#x27;index.php?logout=true&#x27;</span>;&#125;		
	&#125;);
&#125;);
&lt;/script&gt;</code></pre></div>
<p>简单的展示了如果用户点击#exit链接的时候弹出的确认提示， 如果用户确认了退出，也就是说他们决定结束session，那么我们将把他们送回到index.php?logout=true。 这个简单的创建了一个叫logout并且值为true的变量。 我们将要使用PHP来抓住这个变量。</p>
<div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;logout&#x27;</span>]))&#123; 
     
    <span class="hljs-comment">//Simple exit message</span>
    <span class="hljs-variable">$fp</span> = fopen(<span class="hljs-string">&quot;log.html&quot;</span>, <span class="hljs-string">&#x27;a&#x27;</span>);
    fwrite(<span class="hljs-variable">$fp</span>, <span class="hljs-string">&quot;&lt;div class=&#x27;msgln&#x27;&gt;&lt;i&gt;User &quot;</span>. <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] .<span class="hljs-string">&quot; has left the chat session.&lt;/i&gt;&lt;br&gt;&lt;/div&gt;&quot;</span>);
    fclose(<span class="hljs-variable">$fp</span>);
     <span class="hljs-comment">//将显示退出聊天室的人名字显示出来</span>
    session_destroy();<span class="hljs-comment">//摧毁session</span>
    header(<span class="hljs-string">&quot;Location: index.php&quot;</span>); <span class="hljs-comment">//</span>
&#125;</code></pre></div>
<p>到这里就完成了一个多人在线聊天室啦</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E8%81%8A%E5%A4%A9%E5%AE%A4/">聊天室</a>
                    
                      <a class="hover-with-bg" href="/tags/PHP/">PHP</a>
                    
                      <a class="hover-with-bg" href="/tags/jquery/">jquery</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/06/19/js%E6%95%B0%E7%BB%84%E6%A0%BC%E5%BC%8F%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E6%88%90%E6%95%B0%E7%BB%84/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">js数组格式字符串转换成数组</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/06/07/Xray%E6%A2%AF%E5%AD%90%E6%90%AD%E5%BB%BA%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%EF%BC%8C%E4%BB%A5%E5%8F%8AQv2ray%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">
                        <span class="hidden-mobile">Xray梯子搭建一键脚本，以及Qv2ray客户端配置使用教程</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
